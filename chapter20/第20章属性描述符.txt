第20章属性描述符
描述符是对多个属性运用相同存取逻辑的一种方式.
描述符是实现了特定协议的类,这个协议包括__get__,__set__和__delete__方法.
property类实现了完整的描述符协议.
通常,可以只实现部分协议.其实,我们在真实的代码中见到的大多数描述符只实现了__get__和__set__方法,还有很多只实现了其中的一个
描述符是Python的独有特征,不仅在应用层中使用,在语言的基础设施中也有用到.除了特性之外,,使用描述符的Python功能还有方法及
classmethod和staticmethod装饰器.
20.1描述符示例:验证属性
特性工厂函数借助函数式编程模式避免重复编写读值方法和设值方法.特性工厂函数是高阶函数,
在闭包中存储storage_name等设置,由参数决定创建哪些存取函数,再使用存取函数构建一个特性实例.
解决这种问题的面向对象方式是描述符类
LineItem系列示例,把quantity特性工厂函数重构成Quantity描述符类
20.1.1 LineItem类第3版:一个简单的描述符
实现了__get__,__set__或__delete__方法的类就是描述符.
描述符的用法是,创建一个实例,作为另一个类的类属性
定义一个Quantity描述符,LineItem类会用到两个Quantity实例:
一个用于管理weight属性,另一个用于管理price属性.
描述符类:实现描述符协议的类,Quantity类
托管类:把描述符实例声明为类属性的类,LineItem类
描述符实例:描述符类的各个实例,声明为托管类的类属性.
托管实例:托管类的实例.LineItem实例是托管实例
储存属性:托管实例中存储自身托管属性的属性.LineItem实例的weight和price属性是储存属性.这种属性与描述符属性不同,描述符属性都是类属性
托管属性:托管类中由描述符实例处理的公开属性,值存储在储存属性中.也就是说,描述符实例和储存属性为托管属性建立了基础.
Quantity实例是LineItem类的类属性.
示例20-1 bulkfood_v3.py: